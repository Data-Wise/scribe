# Scribe v1.1 Plan

> **Focus:** Project System, Note Search, and Scribe CLI

---

## Overview

| Feature | Priority | Effort | Sprint |
|---------|----------|--------|--------|
| **Project System** | P1 | 3 days | 18-19 |
| **Note Search** | P1 | 1 day | 19 |
| **Scribe CLI** | P2 | 2 days | 20 |

---

## 1. Project System

### Goal
Organize notes into projects with per-project settings, templates, and quick switching.

### User Stories
1. **As a writer**, I want to separate work/personal/academic notes
2. **As an academic**, I want per-project citation settings
3. **As an ADHD user**, I want quick project switching without losing focus

### Database Schema

```sql
CREATE TABLE projects (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  type TEXT CHECK(type IN ('research', 'teaching', 'r-package', 'r-dev', 'generic')),
  color TEXT,
  settings JSON,
  created_at INTEGER,
  updated_at INTEGER
);

-- Add project_id to notes table
ALTER TABLE notes ADD COLUMN project_id TEXT REFERENCES projects(id);

-- Index for fast project filtering
CREATE INDEX idx_notes_project ON notes(project_id);
```

### Project Settings JSON

```json
{
  "theme": "deep-focus",
  "font": "iA Writer Duo",
  "fontSize": 18,
  "bibliographyPath": "/path/to/refs.bib",
  "citationStyle": "apa",
  "dailyNoteTemplate": "## {{date}}\n\n### Tasks\n- [ ] \n\n### Notes\n",
  "wordGoal": 500
}
```

### UI Components

| Component | Purpose |
|-----------|---------|
| `ProjectSwitcher.tsx` | Dropdown in sidebar header |
| `ProjectSettings.tsx` | Per-project settings panel |
| `CreateProjectModal.tsx` | New project dialog |
| `ProjectList.tsx` | All projects view |

### Tasks

| Task | Effort | Priority |
|------|--------|----------|
| Database schema + migrations | 2h | P1 |
| Rust commands (CRUD) | 3h | P1 |
| Project store (Zustand) | 2h | P1 |
| ProjectSwitcher component | 3h | P1 |
| CreateProjectModal | 2h | P1 |
| Per-project settings | 3h | P2 |
| Project templates | 2h | P2 |
| Tests | 2h | P1 |

---

## 2. Note Search

### Goal
Search notes within current project or globally with instant results.

### Features

| Feature | Description |
|---------|-------------|
| **Quick search** | âŒ˜F opens search bar |
| **Project scope** | Search within current project |
| **Global scope** | Toggle to search all notes |
| **Highlight matches** | Show matching text in results |
| **Keyboard nav** | Arrow keys to navigate, Enter to open |

### UI Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Search notes...              [Project â–¾] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ Meeting Notes                            â”‚
â”‚    "...discussed the **search** feature..." â”‚
â”‚                                             â”‚
â”‚ ğŸ“„ Research Ideas                           â”‚
â”‚    "...need to **search** for papers..."    â”‚
â”‚                                             â”‚
â”‚ ğŸ“„ Daily Note 2025-12-27                    â”‚
â”‚    "...implement **search** today..."       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation

```typescript
// In api.ts
searchNotes(query: string, projectId?: string): Promise<SearchResult[]>

interface SearchResult {
  noteId: string
  title: string
  snippet: string  // Text around match
  matchCount: number
}
```

### Tasks

| Task | Effort | Priority |
|------|--------|----------|
| Search command (Rust) | 2h | P1 |
| SearchPanel component | 3h | P1 |
| Keyboard shortcut (âŒ˜F) | 0.5h | P1 |
| Result highlighting | 1h | P2 |
| Tests | 1h | P1 |

---

## 3. Scribe CLI

### Goal
Command-line companion for quick capture, note access, and AI queries.

### Commands

| Command | Description | Example |
|---------|-------------|---------|
| `scribe new` | Create note | `scribe new "Meeting Notes"` |
| `scribe daily` | Open/create daily note | `scribe daily` |
| `scribe search` | Search notes | `scribe search "project"` |
| `scribe capture` | Quick capture | `scribe capture "idea for paper"` |
| `scribe list` | List recent notes | `scribe list --project research` |
| `scribe ai` | AI query | `scribe ai "summarize this note"` |
| `scribe open` | Open in Scribe app | `scribe open "Meeting Notes"` |

### Architecture Options

| Option | Pros | Cons |
|--------|------|------|
| **Rust CLI** | Consistent with Tauri, shares code | Longer compile times |
| **Node CLI** | Faster dev, npm distribution | Separate codebase |
| **Shell scripts** | Simplest, integrates with flow-cli | Limited functionality |

**Recommendation:** Start with shell scripts + flow-cli integration, evolve to Rust CLI.

### Phase 1: Shell Integration

```bash
# Add to flow-cli
scribe() {
  case "$1" in
    new)     scribe-new "$2" ;;
    daily)   scribe-daily ;;
    search)  scribe-search "${@:2}" ;;
    capture) scribe-capture "${@:2}" ;;
    *)       scribe-help ;;
  esac
}

# Each command uses sqlite3 to interact with Scribe's database
scribe-new() {
  local title="${1:-Untitled}"
  sqlite3 "$SCRIBE_DB" "INSERT INTO notes (id, title, content, folder, created_at, updated_at) VALUES (lower(hex(randomblob(16))), '$title', '', 'inbox', strftime('%s','now')*1000, strftime('%s','now')*1000)"
  echo "Created: $title"
}
```

### Phase 2: Rust CLI (Future)

```
scribe-cli/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ new.rs
â”‚   â”‚   â”œâ”€â”€ daily.rs
â”‚   â”‚   â”œâ”€â”€ search.rs
â”‚   â”‚   â””â”€â”€ capture.rs
â”‚   â””â”€â”€ db.rs          # Shared with Tauri
```

### Tasks

| Task | Effort | Priority |
|------|--------|----------|
| Shell script prototype | 2h | P1 |
| Integration with flow-cli | 1h | P1 |
| `scribe new` command | 1h | P1 |
| `scribe daily` command | 1h | P1 |
| `scribe search` command | 1h | P1 |
| `scribe capture` command | 1h | P1 |
| Documentation | 1h | P2 |

---

## Sprint Plan

### Sprint 18: Project System Core
- [ ] Database schema + migrations
- [ ] Rust CRUD commands
- [ ] Project store (Zustand)
- [ ] ProjectSwitcher UI

### Sprint 19: Project System + Search
- [ ] CreateProjectModal
- [ ] Per-project settings
- [ ] Note Search (âŒ˜F)
- [ ] SearchPanel component

### Sprint 20: Scribe CLI
- [ ] Shell script implementation
- [ ] flow-cli integration
- [ ] Core commands (new, daily, search, capture)
- [ ] Documentation

---

## Decision Log

| Date | Decision |
|------|----------|
| 2025-12-27 | Start with shell scripts for CLI, evolve to Rust later |
| 2025-12-27 | Project System is P1, blocks other features |
| 2025-12-27 | Note Search scoped to current project by default |

---

## Files to Create

| File | Purpose |
|------|---------|
| `src-tauri/src/projects.rs` | Project CRUD commands |
| `src/renderer/src/store/projectStore.ts` | Project state |
| `src/renderer/src/components/ProjectSwitcher.tsx` | Project dropdown |
| `src/renderer/src/components/CreateProjectModal.tsx` | New project dialog |
| `src/renderer/src/components/SearchPanel.tsx` | Note search UI |
| `~/.config/zsh/functions/scribe.zsh` | CLI commands |

---

## Success Criteria

### v1.1 Release Ready When:
- [ ] Can create/switch/delete projects
- [ ] Notes belong to projects
- [ ] Per-project settings work
- [ ] Note search works (âŒ˜F)
- [ ] CLI commands work from terminal
- [ ] All tests passing
- [ ] Documentation updated
